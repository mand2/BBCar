<!DOCTYPE html>
<html lang="en">

<head>
    <title>YCAR카풀</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Cormorant+Garamond:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

    <link rel="stylesheet" href="css/open-iconic-bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.css">

    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">

    <link rel="stylesheet" href="css/aos.css">

    <link rel="stylesheet" href="css/ionicons.min.css">

    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/icomoon.css">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #FFFEF4
        }

        #popCloseBtn,
        #edit,
        #modeBtn {
            background-color: #6258A4;
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: bold;
            color: #FFF;
            border: 0 !important;
            outline: 0 !important;
        }

        #edit,
        #popCloseBtn {
            width: 100%;
        }

        #popCloseBtn:hover,
        #edit:hover,
        #modeBtn:hover {
            background-color: #413A6D;
        }

        /*        section {
            padding-top: 100px;
        }*/

        #container {
            margin: 0 auto;
        }

        /*div.pt-5 {
float: left;
}*/

        .hero-wrap {
            margin-bottom: 0;
            height: 100vh;
        }

        h2 {
            font-family: 'Noto Sans KR', sans-serif;
        }

        .ftco-navbar-light {
            position: inherit;
            background-color: #FFFEF4 !important;
        }

        /*팝업창 css*/
        #popupDiv {
            top: 0px;
            position: absolute;
            background: white;
            width: 500px;
            height: 550px;
            display: none;
            padding: 50px;
        }

        /* 팝업 배경 css*/
        #popup_mask {
            position: fixed;
            width: 100%;
            height: 1000px;
            top: 0px;
            left: 0px;
            display: none;
            background-color: #000;
            -moz-opacity: 0.8;
            filter: alpha(opacity=80);
            opacity: 0.8;
        }

        /*        .rightDiv {
        float: left;
        width: 30%;
        margin: 10px;
        }*/
    </style>
</head>

<body data-spy="scroll" data-target=".site-navbar-target" data-offset="300" style="overflow: scroll">
    <nav class=" navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light site-navbar-target" id="ftco-navbar">
        <div class="container">
            <a class="navbar-brand" style="color: black">YCAR</a>
            <button class="navbar-toggler js-fh5co-nav-toggle fh5co-nav-toggle" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="oi oi-menu"></span> Menu
            </button>

            <div class="collapse navbar-collapse" id="ftco-nav">
                <ul class="navbar-nav nav ml-auto">
                    <li class="nav-item"><a href="index.html#home-section" class="nav-link"><span>카풀찾기</span></a></li>
                    <li class="nav-item"><a href="index.html#services-section" class="nav-link"><span>나의카풀</span></a></li>
                    <li class="nav-item"><a href="index.html#destination-section" class="nav-link"><span>결제</span></a></li>
                    <li class="nav-item"><a href="index.html#hotel-section" class="nav-link"><span>후기</span></a></li>
                    <li class="nav-item"><a href="index.html#restaurant-section" class="nav-link"><span>마이페이지</span></a></li>
                    <li class="nav-item"><a href="index.html#blog-section" class="nav-link"><span>로그아웃</span></a></li>
                </ul>
            </div>
    </nav>

    <section class="hero-wrap" data-stellar-background-ratio="0.5">

        <div class="container">

            <div class="rightDiv">
                <div class="comment-form-wrap pt-5">
                    <div class="sidebar-box ftco-animate">
                        <h2 class="heading-sidebar">내 정보</h2>
                        <ul class="categories">
                            <li><a>${login.name} (${login.id})</a></li>
                            <li><a>${login.email}</a></li>
                            <li><a>오늘의 닉네임 : ${login.nickname}</a></li>
                            <li><button class="btn py-3 px-4 btn-primary" style="float: right" id="modeBtn" onclick="editForm()">내 정보 수정</button></li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 팝업 배경 DIV -->
            <div id="popup_mask"></div>
            <div id="popupDiv">
                <!-- 팝업창 -->
                <table style="width: 100%">
                    <tr>
                        <td>이메일 주소</td>
                    </tr>
                    <tr>
                        <td><input type="hidden" value="${login.id}" name="id" id="id"><input class="form-control" type="email" id="email" value="${login.email}"></td>
                    </tr>
                    <tr>
                        <td>기존 비밀번호</td>
                    </tr>
                    <tr>
                        <td><input class="form-control" type="password" id="pw1" name="pw1" required></td>
                    </tr>
                    <tr>
                        <td>새로운 비밀번호</td>
                    </tr>
                    <tr>
                        <td><input class="form-control" type="password" id="pw2" name="pw2" required></td>
                    </tr>
                    <tr>
                        <td>비밀번호 다시입력</td>
                    </tr>
                    <tr>
                        <td><input class="form-control" type="password" id="pw3" required><span id="pwSpan"></span><input type="checkbox" id="pwCheck"></td>
                    </tr>
                    <tr>
                        <td><input type="button" class="btn py-3 px-4 btn-primary" id="edit" value="수정하기"></td>
                    </tr>
                    <tr>
                        <td><button class="btn py-3 px-4 btn-primary" id="popCloseBtn">취소</button></td>
                    </tr>
                </table>
            </div>
            <!--<div id="myInfoEdit" class="comment-form-wrap pt-5">

</div>-->

            <div class="rightDiv">
                <div class="comment-form-wrap pt-5">
                    <div class="sidebar-box ftco-animate">
                        <h2 class="heading-sidebar">즐겨찾는 장소</h2>
                        <ul class="categories">
                            <li>루트1 <a href="#" class="btn py-1 px-4 btn-primary">경로 수정</a></li>
                            <li>루트2 <a href="#" class="btn py-1 px-4 btn btn-primary">경로 수정</a></li>
                            <li>루트3 <a href="#" class="btn py-1 px-4 btn btn-primary">경로 수정</a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="rightDiv">
                <div class="comment-form-wrap pt-5">
                    <div class="sidebar-box ftco-animate">
                        <h2 class="heading-sidebar">선호 탑승 환경</h2>
                        <ul class="categories">
                            <li>a</li>
                            <li>b</li>
                            <li>c</li>
                            <li>d</li>
                            <li>e</li>
                            <li><a href="#" class="btn py-1 px-4 btn btn-primary">수정</a></li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </section>


    <!-- loader -->
    <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px">
            <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee" />
            <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00" /></svg></div>


    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-migrate-3.0.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/jquery.animateNumber.min.js"></script>
    <script src="js/scrollax.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
    <script src="js/google-map.js"></script>

    <script src="js/main.js"></script>

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>

    <script>
        $(document).ready(function() {

            // 임시비밀번호 발급 회원 로그인 --> 마이페이지에서 비밀번호 수정페이지 띄우기
            // getParams();

            $('#edit').click(function() {

                // 공백인 상태에서 수정버튼 눌렀을 시 못가게 막음
                var pw1 = $('#pw1').val();
                var pw2 = $('#pw2').val();
                var pw3 = $('#pw3').val();

                if (pw1.length < 1 || pw2.length < 1 || pw3.length < 1) {
                    alert('비밀번호를 입력해주세요!');
                    return false;
                }

                if (!$('#pwCheck').prop('checked')) {
                    alert('[비말번호 불일치] 다시 확인해주세요!');
                    return false;
                }

                $.ajax({
                    url: 'http://localhost:9090/passenger/members/mypage',
                    type: 'PUT',
                    data: JSON.stringify({
                        id: $('#id').val(),
                        pw1: $('#pw1').val(),
                        pw2: $('#pw2').val()
                    }),
                    contentType: 'application/json; charset=utf-8',
                    success: function(data) {
                        if (data == 0) {
                            alert('잘못된 비밀번호');
                        }
                        if (data == 1) {
                            alert('내 정보 수정 성공!');
                            // 임시 비밀번호 수정한 경우를 위해 마이페이지 다시 로딩
                            location.href = "http://localhost:9090/pClient/mypage";
                        }
                        if (data == 2) {
                            alert('*수정오류');
                        }
                    },
                });
                return false;
            });

            // 새로운 비밀번호 일치하는지 확인
            $('#pw3, #pw2').focusout(function() {
                if ($('#pw2').val() == $('#pw3').val() || $('#pw3').val() == $('#pw2').val()) {
                    $('#pwSpan').html('비밀번호 일치');
                    $('#pwSpan').css('color', 'green');
                    $('#pwCheck').prop('checked', true);
                } else {
                    $('#pwSpan').html('비밀번호 불일치');
                    $('#pwSpan').css('color', 'red');
                    $('#pwCheck').prop('checked', false);
                }
            });
        });

        /* 내정보 수정 팝업창 */
        function editForm() {
            $("#popupDiv").css({
                "top": (($(window).height() - $("#popupDiv").outerHeight()) / 2 + $(window).scrollTop()) + "px",
                "left": (($(window).width() - $("#popupDiv").outerWidth()) / 2 + $(window).scrollLeft()) + "px"
                //팝업창을 가운데로 띄우기 위해 현재 화면의 가운데 값과 스크롤 값을 계산하여 팝업창 CSS 설정

            });

            $("#popup_mask").css("display", "block"); //팝업 뒷배경 display block
            $("#popupDiv").css("display", "block"); //팝업창 display block

            $("body").css("overflow", "hidden"); //body 스크롤바 없애기

            $("#popCloseBtn").click(function(event) {
                $('#pw1').val('');
                $('#pw2').val('');
                $('#pw3').val('');
                $("#popup_mask").css("display", "none"); //팝업창 뒷배경 display none
                $("#popupDiv").css("display", "none"); //팝업창 display none
                $("body").css("overflow", "auto"); //body 스크롤바 생성 
            });


        }

        function getParams() {
            // 현재 페이지의 url
            var url = decodeURIComponent(location.href);
            // url이 encodeURIComponent로 인코딩 되었을 때 다시 디코딩
            url = decodeURIComponent(url);

            var params;
            // url에서 '?' 문자 이후의 파라미터 문자열까지 자르기
            params = url.substring(url.indexOf('?') + 1, url.length);
            // 파라미터 구분자("&")로 분리
            params = params.split("&");
            //alert('params: ' + params);
            // ("=")로 분리해서 값 받아오기
            var user = params[0].split("=")[1];

            alert('[임시비밀번호로 로그인 = temp, 일반 로그인 = undefined] 지금 당신은 ==> ' + user);

            if (user == 'temp') {
                // 정보수정 폼 띄우기
                alert('비밀번호를 수정해주세요!');
                $('#myInfo').css('display', 'none');
                editForm();
            }
        }
    </script>

</body></html>
